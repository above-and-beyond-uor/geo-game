{
  "all_procs": {
    "procedure_1.csv": "item,code,max time,text,shuffle 1,map_file,location_sheet,longitude_min,longitude_max,latitude_min,latitude_max,\r\n2,geo_location,user,This is the start of a new experiment.,off,../User/Projects/uor/campus.png,locations.csv,-0.9565,-0.9303,51.434,51.4464,"
  },
  "conditions": "name,notes,stimuli,procedure,fullscreen,welcome,participant_id,end_message,start_message,buffer,scripts,skip_quality,\r\ncondition_1,You can put more detailed notes in this field,stimuli_1.csv,procedure_1.csv,off,,off,,,5,,yes,",
  "all_stims": {
    "stimuli_1.csv": "cue,answer,\r\nA,Apple,\r\nB,Banana,\r\n,,",
    "locations.csv": "long,lat,btn_text,main_text,hidden,\r\n-0.9365,51.4434,a garden,\"<h5 class=\"\"text-primary\"\">What stops existing as soon as you say it?</h5>\n\n<input type=\"\"text\"\" id=\"\"riddle\"\">\n<button id=\"\"riddle_btn\"\">Submit answer</button>\n\n<script>\n$(\"\"#riddle_btn\"\").on(\"\"click\"\", function(){\n  if($(\"\"#riddle\"\").val().toLowerCase().indexOf(\"\"secret\"\") !== -1){\n    bootbox.alert(\"\"Correct, your next activity is to do XXX\"\");\n  } else {\n    bootbox.alert(\"\"That's not the right answer (don't worry about capital letters)\"\");\n  }\n});\n</script>\n\",no,\r\n,,,,,"
  },
  "location": "above-and-beyond-uor/geo-game/uor",
  "public_key": "TIRgQNXt9yOraXlRanFrehbePTT9j4pBzhcuFl3Ed1Y=",
  "surveys": {},
  "trialtypes": {},
  "code": {
    "instruct": "<!--\r\n/*  Collector (Garcia, Kornell, Kerr, Blake & Haffey)\r\n    A program for running experiments on the web\r\n    Copyright 2012-2016 Mikey Garcia & Nate Kornell\r\n\r\n\r\n    This program is free software: you can redistribute it and/or modify\r\n    it under the terms of the GNU General Public License version 3 as published by\r\n    the Free Software Foundation.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n    GNU General Public License for more details.\r\n\r\n    You should have received a copy of the GNU General Public License\r\n    along with this program.  If not, see <http://www.gnu.org/licenses/>\r\n \t\t\r\n\t\tKitten/Cat release (2019-2021) author: Dr. Anthony Haffey (team@someopen.solutions)\t\t\r\n*/\r\n-->\r\n<style>\r\n#instruct_text{\r\n  margin:auto;\r\n  width:500px;\r\n  padding:50px;\r\n  max-height:600px;\r\n  text-align: center;  \r\n}\r\n#proceed_button{\r\n  position:absolute;\r\n  right: 20px;\r\n}\r\n#trial_contents{\r\n  position: absolute;\r\n  top:0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  margin:auto;\r\n  width:600;\r\n  height:600;\r\n}\r\n</style>\r\n<div id=\"trial_contents\">\r\n  <div id=\"instruct_text\">{{text}}</div>\r\n  <div>\r\n    <button class=\"btn btn-primary\" id=\"proceed_button\" onclick=\"Phase.submit()\">Proceed</button>\r\n  </div>\r\n</div>",
    "geo_location": "<!DOCTYPE html>\r\n<html>\r\n<style>\r\n#your_location{\r\n  !background-color: blue;\r\n  border-radius: 50px;\r\n  width: 50px;\r\n  height: 50px;\r\n  position:absolute;\r\n  animation: pulse 2s infinite;\r\n}\r\n#detection_radius{\r\n  border-radius: 100px;\r\n  border-width:5px !important;\r\n  width:  100px;\r\n  height: 100px;\r\n  position:absolute;\r\n  background-color:blue;\r\n  opacity: 0.5;\r\n}\r\n\r\n.pulsate {\r\n  animation: pulse 2s infinite;\r\n}\r\n\r\n@keyframes pulse {\r\n\t0% {\r\n\t\ttransform: scale(0.5);\r\n\t\t!box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.7);\r\n\t\t!border-radius: 50%;\r\n\t}\r\n\r\n\t70% {\r\n\t\ttransform: scale(1);\r\n\t\t!box-shadow: 0 0 0 10px rgba(0, 0, 0, 0);\r\n\t\t!border-radius: 50%;\r\n\t}\r\n\r\n\t100% {\r\n\t\ttransform: scale(0.5);\r\n\t\t!box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);\r\n\t\t!border-radius: 50%;\r\n\t}\r\n}\r\n#campus_map{\r\n  width:900px;\r\n  height:900px;\r\n}\r\n</style>\r\n<body>\r\n\r\n<img id=\"campus_map\" src=\"{{map_file}}\"/>\r\n\r\n<div id=\"detection_radius\" class=\"border border-primary\"></div>\r\n<div id=\"your_location\" class=\"bg-primary\"></div>\r\n<div id=\"lat_long\"></div>\r\n<button id=\"move_up\">Up</button>\r\n<button id=\"move_down\">Down</button>\r\n<button id=\"move_right\">right</button>\r\n<button id=\"move_left\">Left</button>\r\n\r\n<p id=\"demo\"></p>\r\n\r\n<script>\r\nvar pilot_object = {\r\n  down: 0,\r\n  right: 0\r\n}\r\n\r\n$(\"#move_up\").on(\"click\",function(){\r\n  pilot_object.down -= 50;\r\n});\r\n$(\"#move_down\").on(\"click\",function(){\r\n  pilot_object.down += 50;\r\n});\r\n$(\"#move_left\").on(\"click\",function(){\r\n  pilot_object.right -= 50;\r\n});\r\n$(\"#move_right\").on(\"click\",function(){\r\n  pilot_object.right += 50;\r\n});\r\n\r\nvar radius_pixels = 100;\r\n\r\n\r\nfunction center_coords(x_pos,y_pos,element){\r\n  var element_width  = element.css(\"width\").replace(\"px\",\"\");\r\n  var element_height = element.css(\"height\").replace(\"px\",\"\");\r\n  element.css(\"left\", x_pos - element_width/2);\r\n  element.css(\"top\", y_pos - element_height/2);\r\n}\r\n\r\n//https://stackoverflow.com/a/23339967\r\nfunction collidesWith (element1, element2) {\r\n  var Element1 = {};\r\n  var Element2 = {};\r\n\r\n  Element1.top = $(element1).offset().top;\r\n  Element1.left = $(element1).offset().left;\r\n  Element1.right = Number($(element1).offset().left) + Number($(element1).width());\r\n  Element1.bottom = Number($(element1).offset().top) + Number($(element1).height());\r\n\r\n  Element2.top = $(element2).offset().top;\r\n  Element2.left = $(element2).offset().left;\r\n  Element2.right = Number($(element2).offset().left) + Number($(element2).width());\r\n  Element2.bottom = Number($(element2).offset().top) + Number($(element2).height());\r\n\r\n  if (Element1.right > Element2.left && Element1.left < Element2.right && Element1.top < Element2.bottom && Element1.bottom > Element2.top) {\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\n\r\n\r\n//https://www.openstreetmap.org/ is useful for getting coordinates and images\r\n\r\n\t\r\n\r\nvar x_range = [{{longitude_min}},{{longitude_max}}];\r\nvar y_range = [{{latitude_min}},{{latitude_max}}];\r\nvar x_width = x_range[1] - x_range[0];\r\nvar y_width = y_range[1] - y_range[0];\r\n\r\nvar stimuli_locations = parent.parent.Collector.PapaParsed(Phase.get_stim(\"{{location_sheet}}\"));\r\nconsole.log(\"stimuli_locations\");\r\nconsole.log(stimuli_locations);\r\n\r\n\r\nfunction x_y_positions(longitude, latitude){\r\n  var x_pos = parseFloat($(\"#campus_map\").css(\"width\").replace(\"px\",\"\")) * (longitude - x_range[0])/x_width\r\n  var y_pos = parseFloat($(\"#campus_map\").css(\"height\").replace(\"px\",\"\")) * (1-(latitude - y_range[0])/y_width)\r\n  return [x_pos,y_pos];\r\n}\r\n\r\n\r\nstimuli_locations.forEach(function(this_location, index){\r\n  console.log(\"this_location\");\r\n  console.log(this_location);\r\n  \r\n  location_element = $(\"<button>\");\r\n  location_element.html(\"?\")\r\n    .addClass(\"btn\")\r\n    .addClass(\"btn-secondary\")\r\n    .addClass(\"location\")\r\n    .prop(\"id\",\"location_\" + index)\r\n    .prop(\"disabled\",true)\r\n    .css(\"position\", \"absolute\");\r\n  $(document.body).append(location_element);\r\n  [x_pos,y_pos] = x_y_positions(this_location.long, this_location.lat);\r\n  center_coords(x_pos, y_pos, location_element);\r\n});\r\n\r\n\r\n$(\".location\").on(\"click\", function(){\r\n  var this_index = $(this)[0].id.replace(\"location_\",\"\");\r\n  bootbox.alert(stimuli_locations[this_index].main_text);\r\n})\r\n\r\nfunction detect_location(x_pos, y_pos){\r\n  stimuli_locations.forEach(function(this_location, index){\r\n    \r\n    \r\n    [this_longitude, this_latitude] = x_y_positions(this_location.long, this_location.lat);\r\n    x_dist = parseFloat(this_longitude) - parseFloat(x_pos);\r\n    y_dist = parseFloat(this_latitude) - parseFloat(y_pos);\r\n    var this_distance = Math.sqrt(Math.pow(x_dist,2) + Math.pow(y_dist,2));\r\n    //radius_pixels\r\n    if(collidesWith($(\"#detection_radius\")[0], $(\"#location_\" + index)[0])){\r\n\r\n    //if(this_distance < radius_pixels){\r\n      $(\"#location_\" + index).html(this_location[\"btn_text\"]);\r\n      $(\"#location_\" + index).removeClass(\"btn-secondary\", false);\r\n      $(\"#location_\" + index).addClass(\"btn-primary\", false);\r\n      $(\"#location_\" + index).prop(\"disabled\", false);\r\n    }\r\n  });\r\n}\r\n\r\nfunction getLocation() {\r\n  console.log(navigator);\r\n  if (navigator.geolocation) {\r\n    navigator.geolocation.getCurrentPosition(function(position){\r\n      [x_pos,y_pos] = x_y_positions(position.coords.longitude, position.coords.latitude);\r\n      x_pos += pilot_object.right;\r\n      y_pos += pilot_object.down;\r\n  \r\n      \r\n      center_coords(x_pos,y_pos, $(\"#your_location\"));\r\n      center_coords(x_pos,y_pos, $(\"#detection_radius\"));\r\n      \r\n      detect_location(x_pos, y_pos);\r\n      $(\"#lat_long\").html(position.coords.latitude + \"-\" + position.coords.longitude);\r\n      \r\n      \r\n    }, function(error){\r\n      //[x_pos,y_pos] = x_y_positions(position.coords.longitude, position.coords.latitude);\r\n      \r\n      var x_pos = parseFloat($(\"#campus_map\").css(\"width\").replace(\"px\",\"\")) * .5 + pilot_object.right;\r\n      var y_pos = parseFloat($(\"#campus_map\").css(\"height\").replace(\"px\",\"\")) * .5 + pilot_object.down;\r\n      \r\n      center_coords(x_pos,y_pos, $(\"#your_location\"));\r\n      center_coords(x_pos,y_pos, $(\"#detection_radius\"));\r\n      \r\n      detect_location(x_pos, y_pos);\r\n      $(\"#lat_long\").html(x_pos + \"-\" + y_pos);\r\n      \r\n      console.log(\"error:\" + error.message);\r\n    });\r\n  } else { \r\n    x.innerHTML = \"Geolocation is not supported by this browser.\";\r\n  }\r\n}\r\n\r\ngetLocation();\r\nlocation_interval = setInterval(function(){\r\n  getLocation();\r\n},5000);\r\n</script>\r\n\r\n</body>\r\n</html>"
  },
  "procs_csv": {},
  "stims_csv": {}
}